(function(e,t,n,r){function o(t,n){this.element=e(t);this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="minimalect",s={class_container:"minict_wrapper",class_group:"minict_group",class_empty:"minict_empty",class_active:"active",class_selected:"selected",class_hidden:"hidden",class_highlighted:"highlighted",placeholder:"Select a choice",empty:"No results match your keyword."};o.prototype={init:function(){m=this;this.wrapper=e('<div class="'+this.options.class_container+'"></div>');this.element.hide().after(this.wrapper);this.wrapper.append('<input type="text" value="'+(this.element.find("option[selected]").html()||"")+'" placeholder="'+this.options.placeholder+'" />');var t="";if(this.element.find("optgroup").length==0){t=this.parseElements(this.element.html())}else{this.element.find("optgroup").each(function(){t+='<li class="'+m.options.class_group+'">'+e(this).attr("label")+"</li>";t+=m.parseElements(e(this).html())})}this.wrapper.append("<ul>"+t+'<li class="'+m.options.class_empty+'">'+m.options.empty+"</li></ul>");e(n).on("click",function(){m.hideChoices(m.wrapper,m.options)});this.wrapper.on("click",function(e){e.stopPropagation();m.toggleChoices(m.wrapper,m.options)});this.wrapper.find("li:not(."+m.options.class_group+", ."+m.options.class_empty+")").on("click",function(){m.selectChoice(e(this),m.wrapper,m.element,m.options)});this.wrapper.find("li."+m.options.class_group+", li."+m.options.class_empty).on("click",function(e){e.stopPropagation()});this.wrapper.find("input").on("keyup",function(e){switch(e.keyCode){case 38:m.navigateChoices("up",m.wrapper,m.options);return false;break;case 40:m.navigateChoices("down",m.wrapper,m.options);return false;break;case 13:if(m.wrapper.find("li."+m.options.class_highlighted).length!=0)m.selectChoice(m.wrapper.find("li."+m.options.class_highlighted),m.wrapper,m.element,m.options);else m.selectChoice(m.wrapper.find("li:not(."+m.options.class_group+", ."+m.options.class_empty+")").first(),m.wrapper,m.element,m.options);m.hideChoices(m.wrapper,m.options);return false;break}m.filterChoices(m.wrapper,m.options)})},navigateChoices:function(e,t,n){ignored="."+n.class_hidden+", ."+n.class_empty+", ."+n.class_group;if(t.find("li."+n.class_highlighted).length==0){if(e=="up"){t.find("li:not("+ignored+")").last().addClass(n.class_highlighted)}else if(e=="down"){t.find("li:not("+ignored+")").first().addClass(n.class_highlighted)}return false}else{cur=t.find("li."+n.class_highlighted);cur.removeClass(n.class_highlighted);if(e=="up"){if(t.find("li:not("+ignored+")").first()[0]!=cur[0]){cur.prevAll("li").not(ignored).first().addClass(n.class_highlighted)}else{t.find("li:not("+ignored+")").last().addClass(n.class_highlighted)}}else if(e=="down"){if(t.find("li:not("+ignored+")").last()[0]!=cur[0]){cur.nextAll("li").not(ignored).first().addClass(n.class_highlighted)}else{console.log("first");t.find("li:not("+ignored+")").first().addClass(n.class_highlighted)}}}},parseElements:function(t){var n="";e(t).filter("option").each(function(){n+='<li data-value="'+e(this).val()+'">'+e(this).text()+"</li>"});return n},toggleChoices:function(e,t){!e.hasClass(t.class_active)?this.showChoices(e,t):this.hideChoices(e,t)},showChoices:function(e,t){e.addClass(t.class_active).children("ul").fadeIn(150);e.children("input").val("")},hideChoices:function(e,t){e.removeClass(t.class_active).children("ul").fadeOut(100,function(){e.find("li").removeClass(t.class_hidden);e.find("."+t.class_empty).hide();e.find("li."+t.class_highlighted).removeClass(t.class_highlighted)});e.children("input").blur();if(e.children("input").attr("placeholder")!=t.placeholder){e.children("input").val(e.children("input").attr("placeholder"))}else if(e.find("li."+t.class_selected).length==0){e.children("input").val("")}},filterChoices:function(t,n){var r=t.children("input").val();t.find("li."+n.class_highlighted).removeClass(n.class_highlighted);t.find("li:not("+n.class_group+")").each(function(){if(e(this).text().search(new RegExp(r,"i"))<0)e(this).addClass(n.class_hidden);else e(this).removeClass(n.class_hidden)});t.find("li."+n.class_group).removeClass(n.class_hidden).each(function(){nextlis=e(this).nextAll("li").not("."+n.class_hidden+", ."+n.class_empty);if(nextlis.first().hasClass(n.class_group)||nextlis.length==0)e(this).addClass(n.class_hidden)});t.find("."+n.class_empty).hide();if(t.find("li").not("."+n.class_hidden+", ."+n.class_empty).length==0)t.find("."+n.class_empty).show()},selectChoice:function(e,t,n,r){t.find("li").removeClass(r.class_selected);e.addClass(r.class_selected);t.children("input").val(e.text()).attr("placeholder",e.text());n.find("option[selected]").removeAttr("selected");n.find('option[value="'+e.attr("data-value")+'"]').attr("selected","selected")}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
